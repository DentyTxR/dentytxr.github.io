@inject HttpClient Http
@using System.Text.Json

@page "/updates"

<PageTitle>Site Updates</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="mt-8">
    <MudText Typo="Typo.h3">Update Logs</MudText>
    <MudDivider />
    <MudDivider />

    @foreach (var update in updates)
    {
        <UpdatesEntry LatestUpdate="update.LatestUpdate"
                      Title="@(update.Title)"
                      New="update.New"
                      Changes="update.Changes" />

    }
</MudContainer>

@code {
    private bool isLoaded = false;
    private List<UpdateEntry> updates = new();

    protected override async Task OnInitializedAsync()
    {
        var json = await Http.GetStringAsync("updates.json");
        updates = JsonSerializer.Deserialize<List<UpdateEntry>>(json) ?? new();

        isLoaded = true;
    }

    public class UpdateEntry
    {
        public required string Title { get; set; }
        public required List<string> New { get; set; }
        public required List<string> Changes { get; set; }
        public required bool LatestUpdate { get; set; }
    }
}